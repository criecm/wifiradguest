var shortdeb;var purl="/Arrubaguest/protected/index.jsp";var o=new oevnt();var pdfile;var tab_radadmin=new Array();function oevnt(a,d,b,c){this.nombre=a;this.nom=d;this.firstacct=b;this.id=c}function obj_radadmin(f,i,d,b,a,h,g){this.evenement=f,this.createur=i,this.firstaccount=d,this.firstlogin=b,this.infos=a,this.nbaccount=h,this.expiration=g}function print(a){var d=this,c="iframeprint",b=$("iframe#iframeprint");$("iframe#iframeprint").load(a,function(f,g,e){console.log(f);$(this).contents().find("body").append(f);console.log("COmplete download LOULOU");d.callPrint(c)})}function callPrint(b){var a=document.getElementById(b);a.focus();a.contentWindow.print()}function Logout(){var a="formid="+5;$(function(){$.ajax({url:"/Arrubaguest/Create_Accounts",type:"POST",traditionnal:"true",data:a,dataType:"html",success:function(b){$(location).attr("href","https://auth.centrale-marseille.fr/cas/logout")},error:function(d,b,c){if(d.responseText.indexOf("expirée")>=0){alert(d.responseText);$(location).attr("href",purl)}else{alert(d.status);alert(c)}}})})}function ClearAllPanel(){$(".panel").hide();$("#tabev").hide();$(".jumbotron").hide();$("footer").hide();$("#idtext").hide()}function init_display(){$(".panel").hide();$("#tabev").hide();$(".jumbotron").show();$("#idtext").show();$("footer").show()}function init(){var b=Ladda.create(document.querySelector("button#sendevnt"));var a=Ladda.create(document.querySelector("button#sendprov"));var c=Ladda.create(document.querySelector("button#sendadd"));var d=Ladda.create(document.querySelector("button#sendpers"));$("#arrubaform").on("submit",function(g){var q="cevt";var u=$("#evenement");var l=$("#nbaccount");var i=$("#datedeb");var f=$("#comboduree");var e=$("#evntlieu");var t=true;var p=true;var r=$([]).add(u).add(l).add(i).add(f).add(e),m=$(".validateTips");function s(v){m.text(v).addClass("ui-state-highlight");setTimeout(function(){m.removeClass("ui-state-highlight",1500)},800)}function h(x,y,w,v){x.val($.trim(x.val()));if(x.val().length>v||x.val().length<w){x.addClass("ui-state-error");s("La longueur de "+y+" doit être entre "+w+" et "+v+".");return false}else{x.val(x.val().replace(/\\/g,"\\\\"));x.val(x.val().replace(/"/g,'\\"'));return true}}function k(x,y,w,v){x.val($.trim(x.val()));if(x.val().length>v||x.val().length<w){x.addClass("ui-state-error");s(y+" est un champ obligtatoire.");return false}else{return true}}function n(w,v,x){if(!(v.test(w.val()))){w.addClass("ui-state-error");s(x);return false}else{return true}}console.log(u);console.log(l);g.preventDefault();r.removeClass("ui-state-error");t=t&&h(u,"Evenement",6,100);t=t&&n(u,/^[a-zA-Z0-9\u00C0-\u00FF_\.'\(\)\s]+$/,"Caractères alphanumériques et accentués et '()._ ");t=t&&n(l,/^[1-9][0-9]{0,2}$/,"Nombre compris entre 1 et 999 ");t=t&&k(i,"Date début",6,18);t=t&&k(f,"Durée",1,1);t=t&&n(e,/^[a-zA-Z0-9\u00C0-\u00FF_\.'\(\)\s]+$/,"Caractères alphanumériques et accentués et '()._ ");t=t&&h(e,"Lieu événement",4,150);console.log(t);if(t===true){m.text("");var j="evenement="+encodeURIComponent(u.val())+"&nbaccount="+encodeURIComponent(l.val())+"&datedeb="+encodeURIComponent(i.val())+"&duree="+encodeURIComponent(f.val())+"&formid="+encodeURIComponent(q)+"&shortdeb="+encodeURIComponent(shortdeb)+"&evntlieu="+encodeURIComponent(e.val());$.ajax({url:"/Arrubaguest/Create_Accounts",type:"POST",traditionnal:"true",data:j,beforeSend:function(v){b.start()},complete:function(){b.stop()},success:function(v){if(v==="erreur database"){$("#modal_error").modal({backdrop:false});$("#modal_error").modal("show")}else{if(v==="erreur PDF"){$("#modal_error").modal({backdrop:false});$("#modal_error .modal-body").append('<p><b>Erreur céation PDF</b>&nbsp;<span class="glyphicon glyphicon-warning-sign"></span></p>');$("#modal_error").modal("show")}else{$("#accok").modal({backdrop:false});$("#accok").modal("show");console.log("nom du fichier "+v);pdfile=v}}},error:function(x,v,w){b.stop();if(x.responseText.indexOf("expirée")>=0){alert(x.responseText);$(location).attr("href","/Arrubaguest/index.jsp")}else{alert(x.status);alert(w)}}});$("#arrubaform")[0].reset()}});$("#arrubaform0").on("submit",function(f){var p="cprov";var k=$("#nbacct");var e=$("#combo");var g=$("#idrespon");var s=true;var n=true;var q=$([]).add(k).add(e).add(g),l=$(".validateTips0");function r(u){l.text(u).addClass("ui-state-highlight");setTimeout(function(){l.removeClass("ui-state-highlight",1500)},2000)}function h(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r("La longueur de "+w+" doit être entre "+u+" et "+t+".");return false}else{v.val(v.val().replace(/\\/g,"\\\\"));v.val(v.val().replace(/"/g,'\\"'));return true}}function j(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r(w+" est un champ obligtatoire.");return false}else{return true}}function m(u,t,v){if(!(t.test(u.val()))){u.addClass("ui-state-error");r(v);return false}else{return true}}console.log(k);console.log(e);f.preventDefault();q.removeClass("ui-state-error");s=s&&m(k,/^[1-9][0-9]{0,2}$/,"Nombre compris entre 1 et 999 ");s=s&&j(e,"Durée",1,1);s=s&&h(g,"Responsable",5,50);console.log(s+" "+g.val());if(s===true){l.text("");var i="formid="+encodeURIComponent(p)+"&duree="+encodeURIComponent(e.val())+"&nbacct="+encodeURIComponent(k.val())+"&respon="+encodeURIComponent(g.val());$.ajax({url:"/Arrubaguest/Create_Accounts",type:"POST",traditionnal:"true",data:i,beforeSend:function(t){a.start()},complete:function(){a.stop()},success:function(t){console.log(t+" MOI");if(t==="erreur database"){$("#modal_error").modal({backdrop:false});$("#modal_error").modal("show")}else{if(t==="erreur PDF"){$("#modal_error").modal({backdrop:false});$("#modal_error .modal-body").append('<p><b>Erreur céation PDF</b>&nbsp;<span class="glyphicon glyphicon-warning-sign"></span></p>');$("#modal_error").modal("show")}else{$("#accok").modal({backdrop:false});$("#accok").modal("show");pdfile=t}}},error:function(v,t,u){a.stop();if(v.responseText.indexOf("expirée")>=0){alert(v.responseText);$(location).attr("href","/Arrubaguest/index.jsp")}else{alert(v.status);alert(u)}}})}$("#arrubaform0")[0].reset()});$("#arrubaform1").on("submit",function(f){var p="cpadd";var h=$("#nbadd");var e=$("#searchevnt");console.log(h);f.preventDefault();var s=true;var m=true;var q=$([]).add(h).add(e),k=$(".validateTips1");function r(n){k.text(n).addClass("ui-state-highlight");setTimeout(function(){k.removeClass("ui-state-highlight",1500)},800)}function g(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r("La longueur de "+w+" doit être entre "+u+" et "+t+".");return false}else{v.val(v.val().replace(/\\/g,"\\\\"));v.val(v.val().replace(/"/g,'\\"'));return true}}function j(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r(w+" est un champ obligtatoire.");return false}else{return true}}function l(u,t,v){if(!(t.test(u.val()))){u.addClass("ui-state-error");r(v);return false}else{return true}}q.removeClass("ui-state-error");s=s&&j(e,"Recherche èvènement",1,100);s=s&&l(h,/^[1-9][0-9]{0,2}$/,"Nombre compris entre 1 et 999 ");console.log(s);if(s===true){k.text("");var i="formid="+encodeURIComponent(p)+"&nom="+encodeURIComponent(o.nom)+"&id="+encodeURIComponent(o.id)+"&nbadd="+encodeURIComponent(h.val())+"&oldnb="+encodeURIComponent(o.nombre)+"&firstacct="+encodeURIComponent(o.firstacct);$.ajax({url:"/Arrubaguest/Create_Accounts",type:"POST",traditionnal:"true",data:i,beforeSend:function(n){c.start()},complete:function(){c.stop()},success:function(n){console.log(n+" MOI");if(n==="erreur database"){$("#modal_error").modal({backdrop:false});$("#modal_error").modal("show")}else{if(n==="erreur PDF"){$("#modal_error").modal({backdrop:false});$("#modal_error .modal-body").append('<p><b>Erreur céation PDF</b>&nbsp;<span class="glyphicon glyphicon-warning-sign"></span></p>');$("#modal_error").modal("show")}else{$("#accok").modal({backdrop:false});$("#accok").modal("show");pdfile=n}}},error:function(u,n,t){c.stop();if(u.responseText.indexOf("expirée")>=0){alert(u.responseText);$(location).attr("href","/Arrubaguest/index.jsp")}else{alert(u.status);alert(t)}}})}$("#arrubaform1")[0].reset()});$("#arrubaform3").on("submit",function(e){var p="cpers";var g=1;var j=$("#combopers");e.preventDefault();var s=true;var m=true;var q=$([]).add(j),k=$(".validateTips3");function r(n){k.text(n).addClass("ui-state-highlight");setTimeout(function(){k.removeClass("ui-state-highlight",1500)},800)}function f(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r("La longueur de "+w+" doit être entre "+u+" et "+t+".");return false}else{v.val(v.val().replace(/\\/g,"\\\\"));v.val(v.val().replace(/"/g,'\\"'));return true}}function i(v,w,u,t){v.val($.trim(v.val()));if(v.val().length>t||v.val().length<u){v.addClass("ui-state-error");r(w+" est un champ obligtatoire.");return false}else{return true}}function l(u,t,v){if(!(t.test(u.val()))){u.addClass("ui-state-error");r(v);return false}else{return true}}q.removeClass("ui-state-error");s=s&&i(j,"Durée du compte",1,1);console.log(j.val()+" "+s);if(s===true){k.text("");var h="formid="+encodeURIComponent(p)+"&nbpers="+encodeURIComponent(g)+"&combopers="+encodeURIComponent(j.val());$.ajax({url:"/Arrubaguest/Create_Accounts",type:"POST",traditionnal:"true",data:h,beforeSend:function(n){d.start()},complete:function(){d.stop()},success:function(n){console.log(n+" MOI");if(n==="erreur database"){$("#modal_error").modal({backdrop:false});$("#modal_error").modal("show")}else{if(n=="ismax"){$("#usemax").modal({backdrop:false});$("#usemax").modal("show")}else{if(n==="erreur PDF"){$("#modal_error").modal({backdrop:false});$("#modal_error .modal-body").append('<p><b>Erreur céation PDF</b>&nbsp;<span class="glyphicon glyphicon-warning-sign"></span></p>');$("#modal_error").modal("show")}else{$("#accok").modal("show");pdfile=n}}}},error:function(u,n,t){d.stop();if(u.responseText.indexOf("expirée")>=0){alert(u.responseText);$(location).attr("href","/Arrubaguest/index.jsp")}else{alert(u.status);alert(t)}}})}$("#arrubaform3")[0].reset()})}function gogo(){$(".typeahead").typeahead({minLength:2,name:"zob",source:{url:"/Arrubaguest/LireEvenement",filter:function(a){console.log(a.data)}}})}function Affiche_UserDenom(b){var a=0;$.map(b,function(d,c){a++});if(a==0){}else{$("#tabev").show();$("#tabens tbody").empty();$.map(b,function(d,c){$("#tabens tbody").append("<tr><td>"+d.evenement+"</td><td>"+d.createur+"</td><td>"+d.nbaccount+"</td><td>"+d.firstaccount+"</td><td>"+d.firstlogin+"</td><td>"+d.expiration+"</td><td>"+d.infos+"</td><td>"+d.id+"</td></tr>")})}}function lire_radadmin(){var a="term="+encodeURIComponent("")+"&action="+1;console.log("IN AJAX");tab_radadmin.length=0;$.ajax({url:"/Arrubaguest/LireEvenement",type:"post",traditionnal:"true",data:a,dataType:"json",success:function(b){$.each(b,function(e,d){var c=new Array(d.evenement,d.createur,d.nbacct,d.firstaccount,d.firstlogin,d.expiration,d.infos);if(c[4].indexOf("CEST")!=-1){c[4]=c[4].replace("CEST","")}c[5]=c[5].replace("CEST","");tab_radadmin.push(c);console.log(e+" "+d.evenement+" "+c[4])});$("#tabens").dataTable().fnAddData(tab_radadmin);$("#tabev").show()},error:function(d,b,c){if(d.responseText.indexOf("expirée")>=0){alert(d.responseText)}else{alert(d.status);alert(c)}}})}function lauch(){$("#searchevnt").typeahead({minLength:2,source:function(b,c){user=[];umap={};var a="term="+encodeURIComponent(b)+"&action="+0;console.log("IN AJAX");$.ajax({url:"/Arrubaguest/LireEvenement",type:"post",data:a,dataType:"json",success:function(d){user=[];umap={};$.each(d,function(f,e){$.each(e,function(g,h){if(g==="nom"){umap[h+" (Début "+e.firstaccount.substr(1)+")"]=e;user.push(h+" (Début "+e.firstaccount.substr(1)+")")}})});return c(user)}})},updater:function(a){selecteditem=umap[a];o.nom=selecteditem.nom;o.id=selecteditem.ID;o.firstacct=selecteditem.firstaccount;o.nombre=selecteditem.nombre;return a}})};